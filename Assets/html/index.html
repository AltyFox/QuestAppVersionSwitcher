<html>
<head>
    <title>Quest App Version Switcher - Main</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
    <script async src="https://cse.google.com/cse.js?cx=256b790fca48449ad"></script>
</head>
<body>
    
    <div class="menuContainer">
        <div class="sidebar">
            <div class="header">
                <div style="width: 100%;">Welcome to Quest App Version Switcher</div>
                <div style="font-size: 80%; width: 100%;">
                    Backing <div class="inline packageName">some game</div> up
                </div>
            </div>
            <div class="menuItem selected" section="backup">Backup</div>
            <div class="menuItem" section="downgrade">Downgrade</div>
            <div class="menuItem" section="download">Download progress</div>
            <div class="menuItem" section="patching">Mod my game</div>
            <div class="menuItem" section="mods" id="modsButton">Installed Mods</div>
            <div class="menuItem" section="getMods" id="getModsButton">Get Mods</div>
            <div class="menuItem" section="tools">Tools & Options</div>
        </div>
        <div class="content">
            <div class="contentItem hidden" id="patching">
                <div class="button" id="changeApp3">Change app</div>
                <h3>Currently selected game: <div class="inline packageName">some game</div></h3>
                <div id="patchStatus">Loading...</div>
                <div class="textbox" id="patchingTextBox"></div>

                <h2>Patching options</h2>
                <label class="option">
                    <label class="switch normal">
                        <input id="externalstorage" type="checkbox" checked>
                        <span class="slider round"></span>
                    </label>
                    Add external storage permission
                </label>
                <br>
                <label class="option">
                    <label class="switch normal">
                        <input id="handtracking" type="checkbox" checked>
                        <span class="slider round"></span>
                    </label>
                    Add hand tracking permission
                </label>
                <br>
                <label class="option">
                    Hand tracking version
                    <select id="handtrackingversion">
                        <option value="3">V2</option>
                        <option value="2">V1 high frequency</option>
                        <option value="1">V1</option>
                    </select>
                </label>
                <br>
                <br>
                <label class="option">
                    <label class="switch normal">
                        <input id="debug" type="checkbox" checked>
                        <span class="slider round"></span>
                    </label>
                    Add Debug option
                </label>
                <br>
                <br>
                <input type="text" id="otherName" placeholder="permission name">
                <br>
                <br>
                <div class="button" onclick="AddPermission()">Add Permission</div>
                <br>
                <div id="other">

                </div>
            </div>
            <div class="contentItem hidden" id="mods">
                <div class="button" onclick="LaunchApp()">Launch Game</div>
                <b>Please note that mod installation is in early access, there may be issues. Feel free to give feedback on the OculusDB Discord Server at <code>discord.gg/zwRfHQN2UY</code></b>
                <div class="button" id="installModButton" onclick="UploadMod()">Install a Mod from Disk</div>
                <div id="operations">
                    <h2 id="ongoingCount">Ongoing operations:</h2>
                    <div class="loaderContainer" style="margin-bottom: 10px;">
                        <div class="loaderBarRight"></div>
                        <div class="loaderBarLeft"></div>
                        <div class="loaderBarTop"></div>
                        <div class="loaderBarBottom"></div>
                        <div class="loaderSpinningCircle"></div>
                        <div class="loaderMiddleCircle"></div>
                        <div class="loaderCircleHole"></div>
                        <div class="loaderSquare"></div>
                    </div>
                    <div class="infiniteList" id="operationsList">
                        ${operations}
                    </div>
                </div>
                <h2>Installed Mods</h2>
                <div class="infiniteList" id="modsList">

                </div>
                <h2>Installed Libraries</h2>
                <div class="infiniteList" id="libsList">

                </div>
            </div>
            <div class="contentItem hidden" style="padding: 0px;" id="getMods">
                <h2>To download mods simply download any mod from one of the following sites</h2>
                <div style="display: flex; flex-direction: column;" class="buttonsContainer">
                    <div class="button labelMargin" onclick="OpenSite(`https://computerelite.github.io/tools/Oculus/QAVSHome.html`)">Open website hub</div>
                    <div class="button labelMargin" onclick="OpenSite(`https://computerelite.github.io/tools/Beat_Saber/questmods.html`)">Open Beat Saber Mods page</div>
                    <div class="button labelMargin" onclick="OpenSite(`https://www.google.com/search?q=computerelite`)">Open Google</div>
                </div>
                
            </div>

            <div class="contentItem" id="backup">
                <div class="contentHeader">
                    Backup
                    <div class="contentHeaderDescription">Backup your game and restore backups</div>
                </div>
                <div class="buttonContainer">
                    <div class="button" id="changeApp2">Change app</div>
                    <div class="buttonLabel">Change the app you want to manage</div>
                </div>
                <div>Backups of <div class="inline packageName">some game</div> (<div id="size" class="inline"></div>)</div>
                <div class="smallListContainer">
                    <div id="backupList" class="list">
                    </div>
                </div>


                <div class="contentHeader headerMargin">
                    Restore backups
                    <div class="contentHeaderDescription">Restores the Backup selected above</div>
                    <br>
                    <b class="hidden" id="onPcInfo">You can only restore backups in headset</b>
                    <div class="buttonContainer">
                        <div class="button" id="restoreBackup">Restore Backup</div>
                        <div class="buttonLabel">Restores the selected Backup</div>
                    </div>
                    <div class="buttonContainer">
                        <div class="button" id="deleteBackup">Delete Backup</div>
                        <div class="buttonLabel">Deletes the selected Backup</div>
                    </div>
                    <div id="restoreTextBox" class="textBox"></div>
                </div>

                <div class="contentHeader headerMargin">
                    Create backups
                    <div class="contentHeaderDescription">Change the app at the top</div>
                </div>
                <div>
                    <input type="text" placeholder="Backup Name" id="backupname">
                    <div class="buttonContainer">
                        <div class="button" id="createBackup">Create Backup</div>
                        <div class="buttonLabel">Creates a backup of <div class="inline packageName">some game</div></div>
                    </div>
                    <label><input type="checkbox" id="appdata" value="only backup app data" style="width: auto;">Only backup app data</label>
                    <div id="backupTextBox" class="textBox"></div>
                </div>
            </div>
            <div class="contentItem hidden" style="padding: 0px;" id="downgrade" style="padding: 0px;">
                <b style="font-size: 4em;" id="downgradeLoginMsg">To downgrade you must first log in in the tools & options tab!</b>
                <iframe id="downgradeframe" src=""></iframe>
            </div>
            <div class="contentItem hidden" id="download">
                <div id="progressBarContainers" style="width: 95%;">

                </div>

            </div>
            <div class="contentItem hidden" id="tools">
                <div class="contentHeader">
                    Tools
                    <div class="contentHeaderDescription">Useful for troubleshooting and managing your install</div>
                </div>
                <div class="buttonContainer">
                    <div class="button" id="uninstall">Uninstall app</div>
                    <div class="buttonLabel">Uninstalls the app you selected (needs to be confirmed on android device)</div>
                </div>
                <div class="buttonContainer">
                    <div class="button" id="changeApp">Change app</div>
                    <div class="buttonLabel">Change the app you want to manage</div>
                </div>
                <div class="buttonContainer">
                    <div class="button" id="checkUpdate">Check for QuestAppVersionSwitcher updates</div>
                    <div class="buttonLabel">Checks if updates for QuestAppVersionSwitcher exist</div>
                </div>
                <div id="updateTextBox" class="textBox"></div>

                <div class="space">
                    <div class="contentHeader">
                        Token Section
                        <div class="contentHeaderDescription">Set your token for downgrading games</div>
                    </div>
                    <b id="loggedInMsg">You are logged in. You can login again if you want</b>
                    <div class="buttonContainer">
                        <div class="button" id="login">Login</div>
                        <div class="buttonLabel">Log in with your Oculus/Facebook account to downgrade games (<b>ONLY WORKS ON QUEST, NOT ON PC</b>)</div>
                    </div>
                    <div class="buttonContainer">
                        <input type="password" id="tokeninput" placeholder="Token">
                        <div class="button" id="logintoken">Login with token</div>
                        <div class="buttonLabel">Log in with your Oculus token to downgrade games (Open this page on PC or phone to paste your token; Tipe the link at the bottom in your browser)</div>
                    </div>
                    <a href="https://computerelite.github.io/tools/Oculus/ObtainToken.html">Guide to get your token</a>
                    <div id="tokenTextBox" class="textBox"></div>
                </div>

                <div class="space">
                    <div class="contentHeader">
                        Server control
                        <div class="contentHeaderDescription">Configure the QuestAppVersionSwitcher WebServer</div>
                    </div>
                    <div class="buttonContainer">
                        <div class="button" id="exit">Exit</div>
                        <div class="buttonLabel">Exits QuestAppVersionSwitcher</div>
                    </div>
                    <div class="buttonContainer">
                        <input type="number" placeholder="50002" id="port" class="buttonLabel" value="50002" style="width: 100px;">
                        <div class="button" id="confirmPort">Change port</div>
                        <div class="buttonLabel">Changes the WebServer port</div>
                    </div>
                    <div id="serverTextBox" class="textBox"></div>
                </div>

                <div class="space">
                    <div class="contentHeader">
                        Help
                        <div class="contentHeaderDescription">Utilities to help debugging QuestAppVersionSwitcher</div>
                    </div>
                    <div class="buttonContainer">
                        <input type="password" placeholder="Enter QuestAppVersionSwitcher password" id="logspwd" class="buttonLabel" value="" style="width: 300px;">
                        <div class="button" id="logs">Upload Logs</div>
                        <div class="buttonLabel">ONLY do when instructed to do so. Uploads which apps you own to OculusDB for viewing by support members</div>
                    </div>
                    <div id="logsText" class="textBox"></div>
                </div>

                <div class="space">
                    All Backups together take up <b class="inline totalSize"></b> of space on your Device.
                    <br>
                    You can delete Backups in the Backup section
                </div>
                <div class="about">
                    Quest App Version Switcher Version <div id="version" class="inline"></div>
                    Accessible via browser at:
                    <div id="ips">

                    </div>
                </div>
            </div>
        </div>

        <div class="listContainer darken hidden" id="getPasswordContainer">
            <div class="restoreStep" id="step7">
                <div class="contentHeader headerMargin">
                    Password needed
                </div>
                Please enter the password you set when logging in. If you didn't set one or forgot your password abort the download and head to the <code>Tools & Options</code> section to log in again.
                <br>
                Check the <code>download progress</code> section to see if the download was successful.
                <input type="password" id="passwordConfirm" placeholder="password">
                <div id="step7box" class="textBox"></div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer">
                        <div class="button" id="abortPassword">Abort Download</div>
                    </div>
                    <div class="buttonContainer buttonMargin">
                        <div class="button" id="confirmPassword">Start download</div>
                    </div>
                </div>
            </div>
            <div class="restoreStep" id="step8">
                <div class="contentHeader headerMargin">
                    Password needed
                </div>
                Please enter a password to encrypt your login information (token). You can change this password any time by simply pressing the login button again in the tools & options tab.
                <input type="password" id="passwordToken" placeholder="password">
                <div id="step8box" class="textBox"></div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer buttonMargin">
                        <div class="button" id="tokenPassword">Confirm password</div>
                    </div>
                </div>
            </div>
            <div class="restoreStep" id="step9">
                <div class="contentHeader headerMargin">
                    Login info
                </div>
                To login we'll open auth.meta.com for you. Accept the cookies when Meta or Oculus ask you to. We'll then redirect you to the login. Consenting to cookies is needed so you can log in.
                <br />
                <br />
                <b>If not done automatically after loggin in press the <code>Oculus (Login)</code> button at the top and on the oculus site find the login button to complete the login</b>
                <div id="step9box" class="textBox"></div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer">
                        <div class="button" id="confirmLogin">Login</div>
                    </div>
                    <div class="buttonContainer buttonMargin">
                        <div class="button" id="abortLogin">Abort Login</div>
                    </div>
                </div>
            </div>
            <div class="restoreStep" id="step10">
                <div class="contentHeader headerMargin">
                    Almost there
                </div>
                To finish logging in you must restart QuestAppVersionSwitcher. Do that now.
                <div id="step10box" class="textBox"></div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer">
                        <div class="button" id="closeApp">Close App</div>
                    </div>
                </div>
            </div>
            <div class="restoreStep" id="step11">
                <div class="contentHeader headerMargin">
                    Update Available
                </div>
                <div id="updateAvailableText"></div>
                <div id="step11box" class="textBox"></div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer">
                        <div class="button" id="updateqavs">Update QuestAppVersionSwitcher</div>
                    </div>
                    <div class="buttonContainer buttonMargin">
                        <div class="button" id="cancelupdate">Update later</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="listContainer darken hidden" id="deleteContainer">
            <div class="restoreStep" id="step6">
                <div class="contentHeader headerMargin">
                    Confirm
                </div>
                Do you really want to delete <div class="selectedBackupName inline"></div> of <div class="inline packageName">some game</div>?
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer">
                        <div class="button" id="abortDelete">No! Abort!</div>
                    </div>
                    <div class="buttonContainer buttonMargin">
                        <div class="button" id="delete">Yes. Delete the Backup</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="listContainer darken hidden" id="restoreContainer">
            <div id="step1" class="restoreStep">
                <div class="contentHeader headerMargin">
                    Step 1
                </div>
                <div><b>Restoring a backup will overwrite your current installation. If you do not want to loose your current installtion you <u>must</u> backup it first.<br>To do this abort the restore process and create a backup.</b></div>
                <br>
                <b>Selected backup:</b> <div class="selectedBackupName inline"></div> of <div class="inline packageName">some game</div>
                <br>
                As a first step of the restore process you need to uninstall the current installation of this app (<div class="inline packageName">some game</div>).
                <br>
                <br>
                <i>The restore Process has to be done in headset</i>
                <div id="step1box" class="textBox"></div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer">
                        <div class="button" id="abort">Abort Restore</div>
                    </div>
                    <div class="buttonContainer buttonMargin">
                        <div class="button" id="uninstall2">Start uninstall</div>
                    </div>
                </div>

            </div>
            <div id="step2" class="restoreStep hidden">
                <div class="contentHeader headerMargin">
                    Step 1.1
                </div>
                After the uninstall completed please press the continue button
                <br>
                <br>
                <i>If you didn't get a prompt then press continue as well</i>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer">
                        <div class="button" id="confirm1">Continue</div>
                    </div>
                </div>
            </div>
            <div id="step3" class="restoreStep hidden">
                <div class="contentHeader headerMargin">
                    Step 2
                </div>
                Now that you got the old verion uninstalled we can restore your backup!
                <br>
                We are going to install the apk (your app).
                <br>Press the install button to start the installation.
                <br>If your Quest says <code>Package Installer isn't responding</code> simply press <code>close</code>
                <div id="step3box" class="textBox"></div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer">
                        <div class="button" id="install">Install app</div>
                    </div>
                </div>
            </div>
            <div id="step4" class="restoreStep hidden">
                <div class="contentHeader headerMargin">
                    Step 2.1
                </div>
                After the install completed please press the restore App Data button.
                <br>
                This will restore the app data and obbs you backed up. If you wish to not restore App Data and obbs simply press the skip button
                <div id="step4box" class="textBox"></div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer">
                        <div class="button" id="restoreappdata">Restore App Data</div>
                    </div>
                    <div class="buttonContainer buttonMargin">
                        <div class="button" id="skip">Skip</div>
                    </div>
                </div>
            </div>
            <div id="step5" class="restoreStep hidden">
                <div class="contentHeader headerMargin">
                    Step 2.1
                </div>
                Press continue after the installation finished. We'll then validate if the backup was successfully restored.
                <div id="step5box" class="textBox"></div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer buttonMargin">
                        <div class="button" id="skip2">continue</div>
                    </div>
                </div>
            </div>
            <div id="step6" class="restoreStep hidden">
                <div class="contentHeader headerMargin">
                    Finished!
                </div>
                You restored the backup <div class="slectedBackupName inline"></div> of <div class="inline packageName">some game</div>
                <div class="buttonSelectionContainer">
                    <div class="buttonContainer buttonMargin">
                        <div class="button" id="abort2">Close</div>
                    </div>
                </div>
            </div>
        </div>
        <div class="listContainer hidden" id="appListContainer">
            <div id="appList" class="list hidden">
            </div>
        </div>
    </div>
    
    <div id="toasts"></div>
    <script src="script.js"></script>
</body>
</html>